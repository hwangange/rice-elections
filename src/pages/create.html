<!-- Load JS / CSS
================================================== -->
<link href="css/datepicker.css" rel="stylesheet">
<link href="css/timepicker.css" rel="stylesheet">
<script src="js/prettify.js" type="text/javascript"></script>
<script src="js/bootstrap-datepicker.js"></script>
<script src="js/bootstrap-timepicker.js"></script>
<section id="main">
 <!-- PUT CONTENT IN HERE
================================================== --> 
  <form class="form-horizontal well" id="createForm">
    <fieldset>
      <legend>1. Election Information</legend>
      <div class="control-group">
        <label class="control-label" for="organization">Organization</label>
        <div class="controls">
          <select id="organization" class="input-xlarge">
            <option>Brown College</option>
          </select>
        </div>
      </div>
      
      <!-- Election Name -->
      <div class="control-group">
        <label class="control-label" for="name">Election Name</label>
        <div class="controls">
          <input type="text" class="input-xlarge" id="name">
        </div>
      </div>

      <!-- Start and End Date Time -->
      <div class="control-group">
        <label class="control-label">Voting Times</label>
        <div class="controls controls-row">
          <!-- Start Date -->
          <div class="input-append date" data-date-format="mm/dd/yy">
            <input class="input-mini" size="16" type="text" readonly="" id="startDate">
            <span class="add-on"><i class="icon-calendar"></i></span>
          </div>
          <!-- Start Time -->
          <div class="input-append bootstrap-timepicker-component">
            <input class="input-mini timepicker-default" type="text" id="startTime">
            <span class="add-on"><i class="icon-time"></i></span>
          </div>

          <span class="help-inline">-</span>

          <!-- End Date -->
          <div class="input-append date" data-date-format="mm/dd/yy">
            <input class="input-mini" size="16" type="text" readonly="" id="endDate">
            <span class="add-on"><i class="icon-calendar"></i></span>
          </div>
          <!-- End Time -->
          <div class="input-append bootstrap-timepicker-component">
            <input class="input-mini timepicker-default" type="text" id="endTime">
            <span class="add-on"><i class="icon-time"></i></span>
          </div>
        </div>
      </div>
      <!-- Eligible Voters -->
      <div class="control-group">
        <label class="control-label" for="textarea">Eligible Voters</label>
        <div class="controls">
          <textarea class="span5" id="textarea" rows="5" placeholder="Comma separated NetIDs"></textarea>
        </div>
      </div>
      
      <!-- Add Positions -->
      <div class="control-group">
        <label class="control-label" for="positions">Positions</label>
        <div class="controls" id="positions">
          <a data-toggle="modal" href="#addPositions" class="btn">Add Position</a>
        </div>
      </div>
      
      <!-- Add Positions Modal -->
      <div id="addPositions" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="addPositionsLabel" aria-hidden="true">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
          <h3 id="addPositionsLabel">Add Position</h3>
        </div>
        <div class="modal-body">
          <div class="control-group">
            <label class="control-label" for="selectPositionType">Position type</label>
            <div class="controls">
              <select id="selectPositionType">
                <option value="0">Ranked-Choice Voting Position</option>
                <option value="1">Single-Choice Voting Position</option>
              </select>
            </div>
          </div>
          
          <!-- Single Person Position -->
          <div class="selection-content" id="0">
            <h4>Ranked-Choice Voting Position</h4>
            <p>Ranked-Choice Voting (also known as instant runoff voting) allows voters to rank a first, second, third (and onwards) choice candidate for a single position. This makes it possible to elect people by majority vote without the need for a separate run-off election.</p>
            <form>
              <fieldset>
                <!-- Position Name -->
                <div class="control-group">
                  <label class="control-label" for="name">Position Name</label>
                  <div class="controls">
                    <input type="text" class="input-xlarge" id="position-name">
                  </div>
                </div>
                
                <div class="control-group">
                  <label class="control-label" for="slots">Slots</label>
                  <div class="controls">
                    <input type="number" class="input-mini" name="slots" min="1" max="10" id="slots" value="1">
                  </div>
                </div>
              </fieldset>
            </form>
            <h4>Popover in a modal</h4>
            <p>This <a href="#" role="button" class="btn popover-test" data-content="And here's some amazing content. It's very engaging. right?" data-original-title="A Title">button</a> should trigger a popover on click.</p>
  
            <h4>Tooltips in a modal</h4>
            <p><a href="#" class="tooltip-test" data-original-title="Tooltip">This link</a> and <a href="#" class="tooltip-test" data-original-title="Tooltip">that link</a> should have tooltips on hover.</p>
          </div>
          
          <!-- Multiple People Position -->
          <div class="selection-content" id="1" style="display:none">
            <h4>Multiple People Position</h4>
            <p>Duis mollis, est non commodo luctus, nisi erat porttitor ligula, eget lacinia odio sem.</p>
  
            <h4>Popover in a modal</h4>
            <p>This <a href="#" role="button" class="btn popover-test" data-content="And here's some amazing content. It's very engaging. right?" data-original-title="A Title">button</a> should trigger a popover on click.</p>
  
            <h4>Tooltips in a modal</h4>
            <p><a href="#" class="tooltip-test" data-original-title="Tooltip">This link</a> and <a href="#" class="tooltip-test" data-original-title="Tooltip">that link</a> should have tooltips on hover.</p>
          </div>
          
          <hr>

          <h4>Overflowing text to show optional scrollbar</h4>
          <p>We set a fixed <code>max-height</code> on the <code>.modal-body</code>. Watch it overflow with all this extra lorem ipsum text we've included.</p>
          <p>Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.</p>
          <p>Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.</p>
          <p>Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.</p>
          <p>Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.</p>
          <p>Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.</p>
          <p>Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.</p>
        </div>
        <div class="modal-footer">
          <button class="btn" data-dismiss="modal">Close</button>
          <span id="addPositionButton" class="btn btn-primary">Add Position</span>
        </div>
      </div>
      
      <!-- Form Actions -->
      <div class="form-actions">
        <button type="submit" class="btn btn-primary">Continue</button>
        <button type="reset" class="btn">Cancel</button>
      </div>
    </fieldset>
  </form>
</section>
<script type="text/javascript">
    $(document).ready(function () {
        // Initialize the date / time pickers.
        $('#startDate').parent().datepicker();
        $('#startTime').timepicker({
                minuteStep: 5,
        });
        $('#endDate').parent().datepicker();
        $('#endTime').timepicker({
                minuteStep: 5,
        });
        
        // Form validation
        $('#createForm').submit(validateForm);
        
        
    });
    
    function validateForm() {
        var validationStatuses = [validateElectionName(), validateElectionTimes()];
        console.log('Validation Statuses: ' + validationStatuses);
        return false;
    }
    
    // Validate individual fields live
    $('#name').blur(validateElectionName);

    function validateElectionName() {
        var name = $('#name');
        var nameContainer = name.parent().parent();
        if (name.val() == '') {   // Name not specified
            // Animate to name
            $('html, body').animate({
                scrollTop: $(name).offset().top
            }, 500);
            // Mark error if not already marked
            if (!nameContainer.hasClass('error')) {
                nameContainer.addClass('error');
                
                $('<span class="help-inline errorMsgName">Please enter election name.</span>').insertAfter(name);
            }
            return false;
        }
        
        // Valid election name
        if (nameContainer.hasClass('error')) {    // Remove error mark
            nameContainer.removeClass('error');
            $('.errorMsgName').remove();
        }
        return true;
        
    }
    
    function validateElectionTimes() {
        var startDate = $('#startDate');
        var startTime = $('#startTime');
        var endDate = $('#endDate');
        var endTime = $('#endTime');
        var timeContainer = startDate.parent().parent().parent();
        var errorMessage = '';
        
        // Make sure user has entered all information
        if (!startDate.val() || !startTime.val() || !endDate.val() || !endTime.val()) {
            errorMessage = 'Missing information.';
        }
        
        // if (!errorMessage) {
            // // Validate start and end date / time
        // }
        
        
        if (errorMessage) {
            console.log('Missing information');
            // Mark error if not already marked
            if (!timeContainer.hasClass('error')) {
                timeContainer.addClass('error');
            }
            
            // Clear existing error message
            $('.errorMsgTime').remove();
            
            // Add new error message
            startDate.parent().parent().append('<span class="help-inline errorMsgTime">' + errorMessage + '</span>');
        } else {
            timeContainer.removeClass('error');
            $('.errorMsgTime').remove();
        }
        return false;
    }
    
    $('#selectPositionType').change(function() {
        // Hide all of the other selection content
        $('.selection-content').hide();
        var selectedId = $(this).val();
        $('#' + selectedId).show();
    });
    
    $('#addPositionButton').click(function() {
        $('#addPositions').modal('hide');
        $('#positions').append('<h3>New Position</h3>');
        $('#positions h3:last-child').hide().fadeIn(2000);
    });
</script>